{
    "contents" : "## Creates sixth plot for the Coursera Exploratory Data Analysis Second Course Project \n## CAUTION: DPLYR, ggplot2 and cowplot package required\nlibrary(\"dplyr\")\nlibrary(\"cowplot\")\nlibrary(\"ggplot2\")\n\n## Reads the data\nNEI <- readRDS(\"summarySCC_PM25.rds\")\nSCC <- readRDS(\"Source_Classification_Code.rds\")\n\n## Filter SCC for vehicles only \ncoal <- SCC[grepl(\"vehicle\",SCC$EI.Sector, ignore.case = TRUE),]\n\n## Filter NEI for vehicles only\nNEI <- NEI[NEI$SCC %in% coal$SCC,]\n\n## Filter to Baltimore and LA data only\ncities <- filter(NEI, fips == \"24510\"|fips == \"06037\")\n\n## Groups data by year and type\ngrouped <- group_by(cities, fips, year)\n\n## Summarises the total emissions of each year\ntotaled <- summarise(grouped, PM25 = sum(Emissions))\n\n## Replace fips by proper name\ntotaled$fips[totaled$fips == \"06037\"] <- \"Los Angeles County\"\ntotaled$fips[totaled$fips == \"24510\"] <- \"Baltimore City\"\n\n## Plots the first graph\nplot <- ggplot(totaled,aes(factor(year),PM25,fill=fips)) +\n    geom_bar(stat=\"identity\") +\n    facet_grid(.~fips) +\n    scale_fill_discrete(name=\"Region\") +\n    labs(x=\"Year\",y=\"Emissions in tons\", title=\"PM25 Emissions by Region and Year\") +\n    geom_text(aes(label=round(PM25)),size=4,vjust=1)\n\n## Creating a second graph showing relative change to previous year\ntotaled_relative <- mutate(totaled, base=lag(PM25), change = (100*(PM25 / base)-100))\n\n## Plots the second graph\nplot2 <- ggplot(totaled_relative,aes(factor(year),change,fill=fips)) +\n    geom_bar(stat=\"identity\") +\n    facet_grid(.~fips) +\n    scale_fill_discrete(name=\"Region\") +\n    labs(x=\"Year\",y=\"Change in percent relative to previous year\", title=\"Change in PM25 Emissions by Region compared to previous year\") +\n    geom_abline(intercept = 0, slope = 0, colour = \"black\") +\n    geom_text(aes(label=paste0(round(change,1),\"%\")),size=4,vjust=1)\n\n## Creating a third graph showing relative change to 1999\ntotaled_relative <- mutate(totaled_relative, beginchange = ifelse(fips==\"Baltimore City\",100*PM25/346.82,100*PM25/3931.12))\n\n## Plots the third graph\nplot3 <- ggplot(totaled_relative,aes(factor(year), beginchange,fill=fips)) +\n    geom_bar(stat=\"identity\") +\n    facet_grid(.~fips) +\n    scale_fill_discrete(name=\"Region\") +\n    labs(x=\"Year\",y=\"Emissions as Percentage of 1999's\", title=\"Relative levels PM25 Emissions by Region and Year compared to 1999\") +\n    geom_abline(intercept = 100, slope = 0, colour = \"black\") +\n    geom_text(aes(label=paste0(round(beginchange,1),\"%\")),size=4,vjust=1)\n\n## Creating a fourth graph showing the absolute change compared to previous year\ntotaled_relative <- mutate(totaled_relative, abs_change = PM25 - base)\n\n## Plots the fourth graph\nplot4 <- ggplot(totaled_relative,aes(factor(year),abs_change,fill=fips)) +\n    geom_bar(stat=\"identity\") +\n    facet_grid(.~fips) +\n    scale_fill_discrete(name=\"Region\") +\n    labs(x=\"Year\",y=\"Change of Emissions in tons\", title=\"Absolute change of PM25 Emissions by Region and Year compared to previous year\") +\n    geom_abline(intercept = 0, slope = 0, colour = \"black\") +\n    geom_text(aes(label=round(abs_change)),size=4,vjust=1)\n\n## Creates a PNG graphic device\npng(filename = \"plot6.PNG\", width=1280, height=800)\n\n## Prints the graphs\nplot_grid(plot,plot4,plot3,plot2, align=\"hv\", ncol=2)\n\n## Ends the PNG graphic device\ndev.off()",
    "created" : 1443993994309.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2339749015",
    "id" : "A2B1C87",
    "lastKnownWriteTime" : 1443994004,
    "path" : "~/R/Coursera/assignments/exdata-032/ExData_Plotting2/plot6_alt2.R",
    "project_path" : "plot6_alt2.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 9,
    "source_on_save" : false,
    "type" : "r_source"
}